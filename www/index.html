<!DOCTYPE html>
<html>
    <head>
        <!--
        Customize this policy to fit your own app's needs. For more guidance, see:
            https://github.com/apache/cordova-plugin-whitelist/blob/master/README.md#content-security-policy
        Some notes:
            * gap: is required only on iOS (when using UIWebView) and is needed for JS->native communication
            * https://ssl.gstatic.com is required only on Android and is needed for TalkBack to function properly
            * Disables use of inline scripts in order to mitigate risk of XSS vulnerabilities. To change this:
                * Enable inline JS: add 'unsafe-inline' to default-src
                #####script-src 'self' http://* 'unsafe-inline' 'unsafe-eval'  ; 
                #####img-src * (resulting in loading picture error) 
        -->
        <meta charset="utf-8">
<!--         <meta http-equiv="Content-Security-Policy" content="default-src 'unsafe-inline' 'self' data: gap: https://ssl.gstatic.com 'unsafe-eval'; style-src 'self' 'unsafe-inline'; script-src 'self' http://* 'unsafe-inline' 'unsafe-eval'; media-src *"> -->
        <meta name="format-detection" content="telephone=no">
        <meta name="msapplication-tap-highlight" content="no">
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">

        <title>App Using Bootstrap</title>
        <!--  For Bootstrap -->
        <link rel="stylesheet" href="themes/Bootstrap.css">
        <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
        <link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" />
        <script src="http://code.jquery.com/jquery-2.0.1.min.js"></script>
        <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>

        <!--  For shopping cart -->
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/index.js"></script> 
        <script type="text/javascript" src="js/jquery.imgcheckbox.js"></script> 
        <script type="text/javascript" src="js/jquery.fly.min.js"></script>
        <script type="text/javascript" src="http://maps.google.com/maps/api/js?key=AIzaSyCVFbdpItEFLcCD1cWpqxOb9FdZRwJNd4I&libraries=places"></script>
<!--for future use:         <script type="text/javascript" src="js/jqthumb.min.js" ></script> -->
    </head>
    <body>

		<div data-role="page" id="Home" data-theme="e">
			<div data-role="header" data-id="navbar" data-position="fixed" data-tap-toggle="false">
				<div data-role="navbar">
					<ul>
                        <li><a href="#Home" data-icon="home" class="ui-btn-active">HomePage</a> </li>
                        <li><a href="#NBList" data-icon="location" >NearBy</a></li>
                        <li><a href="#Favourate" data-icon="star" >Favourate</a></li>
                        <li><a href="#Search" data-icon="search" >Search</a></li>
					</ul>
				</div>				
			</div>

			<div data-role="content" data-theme="e">
				<p>Welcome to home page.</p>
			</div>

			<div data-role="footer" data-theme="e" data-position="fixed" data-tap-toggle="false">
                <div data-role="navbar">
                    <ul>
                        <li><a href="#" data-icon="tag" class="ui-btn-active">Browse</a></li>
                        <li><a href="#" data-icon="comment">Discount</a></li>
                        <li><a href="#spCart" data-icon="shop">Cart
                        <span id="Counter1" class="ui-li-count" display="block">0</span></a></li>
                        <li><a href="#" data-icon="user">Account</a></li>
                    </ul>
                </div>            
			</div>
		</div>

        
        <div data-role="page" id="NBList" data-theme="e">
            <div data-role="header" data-id="navbar" data-position="fixed" data-tap-toggle="false">
                <div data-role="navbar">
                    <ul>
                        <li><a href="#Home" data-icon="home" >HomePage</a> </li>
                        <li><a href="#NBList" data-icon="location" class="ui-btn-active">NearBy</a></li>
                        <li><a href="#Favourate" data-icon="star" >Favourate</a></li>
                        <li><a href="#Search" data-icon="search" >Search</a></li>
                    </ul>
                </div>              
            </div>
            <div data-role="content" >
                <div id="map_canvas" style="height:300px;width:100%"></div>
                <!-- <img src="./img/googleMap.jpeg" align="center" width="100%" /> --> 
                <label id="map_debug"></label>
                <p>NEARBY FLYERS </p>
                    <div>

                        <table>
                            <tr>
                                <td>
                                    <a id="flyer1-a" href="#proDetail" >
                                    <table class="proTable" border="0" cellspacing="1" cellpadding="0">
                                      <tbody>
                                        <tr>
                                          <td class="topRow"><span id="flyer1-name"></span></td>
                                        </tr>
                                        <tr>
                                          <td class="contentRow"> 
                                            
                                             <table>
                                                <tr>
                                                    <td>
                                                        <div id="flyer1-Div1" data-product="1001" class="product" >
                                                            
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div id="flyer1-Div2" data-product="1002" class="product" >

                                                        </div>
                                                    </td>

                                                </tr>
                                                <tr>
                                                    <td>
                                                        <div id="flyer1-Div3" data-product="1003" class="product" >

                                                        </div>

                                                    </td>                                                
                                                    <td>
                                                        <div id="flyer1-Div4" data-product="1004" class="product"  >

                                                        </div> 

                                                    </td>

                                                </tr>
                                                <tr>
                                                    <td>
                                                        <div id="flyer1-Div5" data-product="1005" class="product" >

                                                        </div>

                                                    </td>
                                                    <td>
                                                        <div id="flyer1-Div6" data-product="1006" class="product">

                                                        </div>

                                                    </td>
                                                </tr>

                                            </table>
                                            

                                          </td>
                                        </tr>
                                        <tr>
                                          <td class="bottomRow"></td>
                                        </tr>
                                      </tbody>
                                    </table>                                    
                                    </a>
                                
                                </td> 
                                <td>
                                    <a id="flyer2-a" href="#proDetail" >
                                    <table class="proTable" border="0" cellspacing="1" cellpadding="0">
                                      <tbody>
                                        <tr>
                                          <td class="topRow"><span id="flyer2-name"></span></td>
                                        </tr>
                                        <tr>
                                          <td class="contentRow"> 

                                             <table>
                                                <tr>
                                                    <td>
                                                        <div id="flyer2-Div1" data-product="1001" class="product" >

                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div id="flyer2-Div2" data-product="1002" class="product" >

                                                        </div>
                                                    </td>

                                                </tr>
                                                <tr>
                                                    <td>
                                                        <div id="flyer2-Div3" data-product="1003" class="product" >

                                                        </div>

                                                    </td>                                                
                                                    <td>
                                                        <div id="flyer2-Div4" data-product="1004" class="product"  >

                                                        </div> 

                                                    </td>

                                                </tr>
                                                <tr>
                                                    <td>
                                                        <div id="flyer2-Div5" data-product="1005" class="product" >

                                                        </div>

                                                    </td>
                                                    <td>
                                                        <div id="flyer2-Div6" data-product="1006" class="product">

                                                        </div>

                                                    </td>
                                                </tr>

                                            </table> 

                                          </td>
                                        </tr>
                                        <tr>
                                          <td class="bottomRow"></td>
                                        </tr>
                                      </tbody>
                                    </table>                                      
                                    </a>

                                </td> 
                                <td>
                                    <a id="flyer3-a" href="#proDetail" >
                                    <table class="proTable" border="0" cellspacing="1" cellpadding="0">
                                      <tbody>
                                        <tr>
                                          <td class="topRow"><span id="flyer3-name"></span></td>
                                        </tr>
                                        <tr>
                                          <td class="contentRow"> 

                                             <table>
                                                <tr>
                                                    <td>
                                                        <div id="flyer3-Div1" data-product="1001" class="product" >

                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div id="flyer3-Div2" data-product="1002" class="product" >

                                                        </div>
                                                    </td>

                                                </tr>
                                                <tr>
                                                    <td>
                                                        <div id="flyer3-Div3" data-product="1003" class="product" >

                                                        </div>

                                                    </td>                                                
                                                    <td>
                                                        <div id="flyer3-Div4" data-product="1004" class="product"  >

                                                        </div> 

                                                    </td>

                                                </tr>
                                                <tr>
                                                    <td>
                                                        <div id="flyer3-Div5" data-product="1005" class="product" >

                                                        </div>

                                                    </td>
                                                    <td>
                                                        <div id="flyer3-Div6" data-product="1006" class="product">

                                                        </div>

                                                    </td>
                                                </tr>

                                            </table> 

                                          </td>
                                        </tr>
                                        <tr>
                                          <td class="bottomRow"></td>
                                        </tr>
                                      </tbody>
                                    </table>      
                                    </a>
                                </td>
                            </tr>
                        </table>
                                              
                    </div>
            </div>
            <div data-role="footer" data-theme="e" data-position="fixed" data-tap-toggle="false">
                <div data-role="navbar">
                    <ul>
                        <li><a href="#" data-icon="tag" class="ui-btn-active">Browse</a></li>
                        <li><a href="#" data-icon="comment">Discount</a></li>
                        <li><a href="#spCart" data-icon="shop">Cart
                        <span id="Counter2" class="ui-li-count" display="block">0</span></a></li>
                        <li><a href="#" data-icon="user">Account</a></li>
                    </ul>
                </div>                          
            </div>
        </div>


        <div data-role="page" id="Favourate" data-theme="e">
            <div data-role="header" data-id="navbar" data-position="fixed" data-tap-toggle="false">
                <div data-role="navbar">
                    <ul>
                        <li><a href="#Home" data-icon="home" >HomePage</a> </li>
                        <li><a href="#NBList" data-icon="location" >NearBy</a></li>
                        <li><a href="#Favourate" data-icon="star" class="ui-btn-active">Favourate</a></li>
                        <li><a href="#Search" data-icon="search" >Search</a></li>
                    </ul>
                </div>              
            </div>

            <div data-role="content" data-theme="e">
                <p>Welcome to favourate page.</p>
            </div>

            <div data-role="footer" data-theme="e" data-position="fixed" data-tap-toggle="false">
                <div data-role="navbar">
                    <ul>
                        <li><a href="#" data-icon="tag" class="ui-btn-active">Browse</a></li>
                        <li><a href="#" data-icon="comment">Discount</a></li>
                        <li><a href="#spCart" data-icon="shop">Cart
                        <span id="Counter3" class="ui-li-count" display="block">0</span></a></li>
                        <li><a href="#" data-icon="user">Account</a></li>
                    </ul>
                </div>            
            </div>
        </div>

        <div data-role="page" id="Search" data-theme="e">
            <div data-role="header" data-id="navbar" data-position="fixed" data-tap-toggle="false">
                <div data-role="navbar">
                    <ul>
                        <li><a href="#Home" data-icon="home" >HomePage</a> </li>
                        <li><a href="#NBList" data-icon="location" >NearBy</a></li>
                        <li><a href="#Favourate" data-icon="star" >Favourate</a></li>
                        <li><a href="#Search" data-icon="search" class="ui-btn-active">Search</a></li>
                    </ul>
                </div>
            </div>

            <div data-role="content" data-theme="e">
                <p>Welcome to search page.</p>
            </div>

            <div data-role="footer" data-theme="e" data-position="fixed" data-tap-toggle="false">
                <div data-role="navbar">
                    <ul>
                        <li><a href="#" data-icon="tag" class="ui-btn-active">Browse</a></li>
                        <li><a href="#" data-icon="comment">Discount</a></li>
                        <li><a href="#spCart" data-icon="shop">Cart
                        <span id="Counter4" class="ui-li-count" display="block">0</span></a></li>
                        <li><a href="#" data-icon="user">Account</a></li>
                    </ul>
                </div>            
            </div>
        </div>


        <div data-role="page" id="spCart" data-theme="e">
            <div data-role="header" data-id="navbar" data-position="fixed" data-tap-toggle="false">
                <div data-role="navbar">
                    <ul>
                        <li><a href="#Home" data-icon="home" >HomePage</a> </li>
                        <li><a href="#NBList" data-icon="location" >NearBy</a></li>
                        <li><a href="#Favourate" data-icon="star" >Favourate</a></li>
                        <li><a href="#Search" data-icon="search" >Search</a></li>
                    </ul>
                </div>              
            </div>

            <div data-role="content">
                <div id="cartDIV">
                    EMPTY!
                </div>
            </div>

            <div data-role="footer" data-id="navbar" data-position="fixed" data-tap-toggle="false">
                <div data-role="navbar">
                    <ul>
                        <li><a href="#" data-icon="tag" >Browse</a></li>
                        <li><a href="#" data-icon="comment">Discount</a></li>
                        <li><a href="#spCart" data-icon="shop" class="ui-btn-active">Cart
                        <span id="Counter5" class="ui-li-count" display="block">0</span></a></li>
                        <li><a href="#" data-icon="user">Account</a></li>
                    </ul>
                </div>                                 
            </div>
        </div>


        <div data-role="page" id="proDetail" data-theme="e">
            <div data-role="header" data-id="navbar" data-position="fixed" data-tap-toggle="false">
                <div data-role="navbar">
                    <ul>
                        <li><a href="#NBList" data-icon="back" class="ui-btn-active" align="left">Back</a></li>
                        <li></li>
                        <li></li>
                        <li></li>

                    </ul>
                </div>              
            </div>
            <div data-role="content" >
                    <div >

                        <table class="proTable" border="0" cellspacing="1" cellpadding="0">
                          <tbody>
                            <tr>
                              <td class="topRow"><span id="provider-name"></span></td>
                            </tr>
                            <tr>
                              <td class="contentRow"> 

                                 <table>
                                    <tr>
                                        <td>
                                            <div id="proDiv1" data-product="1001" class="product" >
                                                <img id="proPic1" class="proPic"   />

                                            </div>
                                        </td>
                                        <td>
                                            <div id="proDiv2" data-product="1002" class="product" >
                                                <img id="proPic2" class="proPic"   />

                                            </div>
                                        </td>
                                        <td>
                                            <div id="proDiv3" data-product="1003" class="product" >
                                                <img id="proPic3" class="proPic"   />

                                            </div>

                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div id="proDiv4" data-product="1004" class="product"  >
                                                <img id="proPic4" class="proPic"   />

                                            </div> 

                                        </td>
                                        <td>
                                            <div id="proDiv5" data-product="1005" class="product" >
                                                <img id="proPic5" class="proPic"   />

                                            </div>

                                        </td>
                                        <td>
                                            <div id="proDiv6" data-product="1006" class="product">
                                                <img id="proPic6" class="proPic"  />

                                            </div>

                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div id="proDiv7" data-product="1007" class="product"  >
                                                <img id="proPic7" class="proPic"   />

                                            </div> 

                                        </td>
                                        <td>
                                            <div id="proDiv8" data-product="1008" class="product" >
                                                <img id="proPic8" class="proPic"   />

                                            </div>

                                        </td>
                                        <td>
                                            <div id="proDiv9" data-product="1009" class="product">
                                                <img id="proPic9" class="proPic"  />

                                            </div>

                                        </td>
                                    </tr>            

                                </table> 

                              </td>
                            </tr>
                            <tr>
                              <td class="bottomRow"></td>
                            </tr>
                          </tbody>
                        </table>

                    </div>

            </div>
            <div data-role="footer" data-theme="e" data-position="fixed" data-tap-toggle="false">
                <div data-role="navbar">
                    <ul>
                        <li><a href="#" data-icon="tag" class="ui-btn-active">Browse</a></li>
                        <li><a href="#" data-icon="comment">Discount</a></li>
                        <li><a href="#spCart" data-icon="shop">Cart
                        <span id="Counter6" class="ui-li-count" display="block">0</span><i id="end"></i></a></li>
                        <li><a href="#" data-icon="user">Account</a></li>
                    </ul>
                </div>                          
            </div>
        </div>

        <script type="text/javascript">

            //when to create a specified page event:
            $(document).on("pagebeforeshow", "#proDetail", function() {

                // await sleep(5000);
                // when loading the #NBList page, set the size of the map_canvas
                fillProList(detailPlaces, flyerClick, 9);


            });

            //when to create a specified page event:
            $(document).on("pageshow", "#NBList", function() {

                //fixing the bug: for the first time loading map, it only display partially
                // before refresh the map, need to check if the map has already been created
                refreshMap();


            });


            //After loading this HTML file, initiating the running environment
            $(document).ready(function(){

                if (jQuery) { 
                    console.log("jQuery has been loaded.");        
                } else { 
                    console.log("jQuery has not been loaded.");   
                }; 

                $("#cartDIV").html("");
                // .class--class selector, #id--id selector, $(p)--elements selector, img.proPic--combined selector
                $("img.proPic").imgCheckbox({"scaleSelected":false},{"checkMarkImage":"img/SelectedPic.jpg"},{"checkMarkPosition":"top-right"});

                // function 1: to adding the click event to .proPic
                $(".proPic").on("click",function(event){ 
                    if (!!$(this).hasClass("selected")) {
                        $(this).removeClass("selected");
                        count = count - 1;
                        // console.log(count);
                        refreshCnt(count);
                        refreshCart();


                    } else{
                        $(this).addClass("selected");
                        count = count + 1;
                        // console.log(count);
                        refreshCnt(count);
                        //find只找匹配项下面的子项
                        var imgPath = $(this).attr('src'); 
                        console.log(imgPath);
                        flyTocart(imgPath,event);                    
                        refreshCart();

                    };

                });
                getCurrentLocation(initMap);  //to get the currentLocation firstly, when it finished, using initMap callback function to Async-return
                resizeMap();  // preparing the size to device-height

                // function 2: creating, initiating, updating SQLite database 


            })

        </script> 
        <!-- behind the initMap() function -->


    </body>
</html>


